<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>해외 직구 구매 대행 관리 시스템</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <header>
            <div class="header-left">
                <h1>🌍 해외 직구 구매 대행 관리</h1>
            </div>
            <div class="header-right">
                <div class="user-info">
                    <img id="userPhoto" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='32' height='32'%3E%3Ccircle cx='16' cy='16' r='16' fill='%23667eea'/%3E%3Ctext x='16' y='22' text-anchor='middle' fill='white' font-size='16' font-family='Arial'%3E👤%3C/text%3E%3C/svg%3E" alt="User" class="user-avatar">
                    <div class="user-details">
                        <span id="userName" class="user-name">사용자</span>
                        <span id="userEmail" class="user-email">user@example.com</span>
                    </div>
                </div>
                <button onclick="logout()" class="logout-btn" title="로그아웃">🚪</button>
                <div class="sync-status">
                    <span id="syncStatus" class="status-offline">⚫ 오프라인</span>
                </div>
            </div>
        </header>

        <!-- 탭 네비게이션 -->
        <nav class="tab-nav">
            <button class="tab-btn active" data-tab="statistics">📊 통계</button>
            <button class="tab-btn" data-tab="transactions">📋 거래 내역</button>
        </nav>

        <!-- 통계 탭 -->
        <div id="statisticsTab" class="tab-content active">
            <div class="filter-section">
                <label>기간 선택:</label>
                <select id="statisticsPeriodFilter">
                    <option value="all">전체 기간</option>
                    <option value="today">오늘</option>
                    <option value="week">이번 주</option>
                    <option value="month">이번 달</option>
                    <option value="quarter">최근 3개월</option>
                    <option value="halfYear">최근 6개월</option>
                    <option value="year">올해</option>
                    <option value="custom">직접 입력</option>
                </select>
                <div id="customDateRange" style="display: none;">
                    <input type="date" id="startDate">
                    <span>~</span>
                    <input type="date" id="endDate">
                    <button id="applyCustomDate">적용</button>
                </div>
            </div>
            <div class="stats-grid">
                <div class="stat-card">
                    <h3>총 매출</h3>
                    <p class="stat-value" id="totalRevenue">0원</p>
                </div>
                <div class="stat-card">
                    <h3>총 비용</h3>
                    <p class="stat-value" id="totalCost">0원</p>
                </div>
                <div class="stat-card">
                    <h3>순이익</h3>
                    <p class="stat-value profit" id="totalProfit">0원</p>
                </div>
                <div class="stat-card">
                    <h3>평균 마진률</h3>
                    <p class="stat-value" id="avgMargin">0%</p>
                </div>
            </div>

            <!-- 그래프 섹션 -->
            <div class="charts-section">
                <div class="chart-container">
                    <h3>📈 매출/비용/이익 추이</h3>
                    <canvas id="monthlyChart"></canvas>
                </div>
                
                <div class="charts-row">
                    <div class="chart-container half">
                        <h3>🛒 구매사이트별 거래 비율</h3>
                        <canvas id="purchaseSiteChart"></canvas>
                    </div>
                    <div class="chart-container half">
                        <h3>💰 판매 플랫폼별 매출</h3>
                        <canvas id="platformChart"></canvas>
                    </div>
                </div>

                <div class="charts-row">
                    <div class="chart-container half">
                        <h3>💱 통화별 거래 건수</h3>
                        <canvas id="currencyChart"></canvas>
                    </div>
                    <div class="chart-container half">
                        <h3>📊 브랜드별 Top 10 매출</h3>
                        <canvas id="brandChart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- 거래 내역 탭 -->
        <div id="transactionsTab" class="tab-content">
            <div class="section-header">
                <div class="action-buttons">
                    <button id="exportBtn" class="btn-export">📥 엑셀 다운로드</button>
                </div>
            </div>

            <!-- 필터링 섹션 -->
            <div class="filter-panel">
                <h3>🔍 상세 필터</h3>
                <div class="filter-grid">
                    <div class="filter-group">
                        <label for="filterBuyerName">구매자 이름</label>
                        <input type="text" id="filterBuyerName" placeholder="이름 검색" autocomplete="off">
                    </div>
                    <div class="filter-group">
                        <label for="filterBrand">브랜드</label>
                        <input type="text" id="filterBrand" list="brandList" placeholder="브랜드 선택 또는 검색" autocomplete="off">
                        <datalist id="brandList">
                            <option value="">전체</option>
                        </datalist>
                    </div>
                    <div class="filter-group">
                        <label for="filterProduct">품명</label>
                        <input type="text" id="filterProduct" placeholder="품명 검색" autocomplete="off">
                    </div>
                    <div class="filter-group">
                        <label for="filterPurchaseSite">구매사이트</label>
                        <input type="text" id="filterPurchaseSite" list="siteList" placeholder="구매사이트 선택 또는 검색" autocomplete="off">
                        <datalist id="siteList">
                            <option value="">전체</option>
                            <option value="other">기타</option>
                        </datalist>
                    </div>
                    <div class="filter-group">
                        <label for="filterPlatform">판매 플랫폼</label>
                        <select id="filterPlatform" autocomplete="off">
                            <option value="">전체</option>
                            <option value="coupang">쿠팡</option>
                            <option value="naver">네이버 쇼핑</option>
                            <option value="street11">11번가</option>
                            <option value="gmarket">G마켓</option>
                            <option value="auction">옥션</option>
                            <option value="direct">직거래</option>
                            <option value="custom">기타</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label for="filterCurrency">통화</label>
                        <select id="filterCurrency" autocomplete="off">
                            <option value="">전체</option>
                            <option value="KRW">KRW</option>
                            <option value="USD">USD</option>
                            <option value="EUR">EUR</option>
                            <option value="GBP">GBP</option>
                            <option value="JPY">JPY</option>
                            <option value="CNY">CNY</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label for="filterYear">구매 연도</label>
                        <select id="filterYear" autocomplete="off">
                            <option value="">전체</option>
                        </select>
                    </div>
                </div>
                <div class="filter-actions">
                    <button id="resetFiltersBtn" class="btn-reset">🔄 필터 초기화</button>
                    <span id="filterResultCount" class="filter-count">전체 0건</span>
                </div>
            </div>

            <div id="transactionsList" class="transactions-list">
                <p class="empty-message">등록된 거래 내역이 없습니다.</p>
            </div>
        </div>
    </div>

    <!-- 플로팅 버튼 -->
    <div class="floating-buttons">
        <button id="marginCalculatorBtn" class="floating-btn margin-calc-btn" title="마진율 계산기">
            <svg class="calc-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <!-- 계산기 외곽 -->
                <rect x="4" y="2" width="16" height="20" rx="2" stroke="white" stroke-width="2" fill="none"/>
                <!-- 액정 디스플레이 -->
                <rect x="6" y="4" width="12" height="4" rx="1" fill="white"/>
                <!-- 버튼들 -->
                <rect x="6" y="10" width="2.5" height="2.5" rx="0.5" fill="white"/>
                <rect x="9.5" y="10" width="2.5" height="2.5" rx="0.5" fill="white"/>
                <rect x="13" y="10" width="2.5" height="2.5" rx="0.5" fill="white"/>
                <rect x="16.5" y="10" width="2.5" height="2.5" rx="0.5" fill="white"/>
                
                <rect x="6" y="13.5" width="2.5" height="2.5" rx="0.5" fill="white"/>
                <rect x="9.5" y="13.5" width="2.5" height="2.5" rx="0.5" fill="white"/>
                <rect x="13" y="13.5" width="2.5" height="2.5" rx="0.5" fill="white"/>
                <rect x="16.5" y="13.5" width="2.5" height="2.5" rx="0.5" fill="white"/>
                
                <rect x="6" y="17" width="2.5" height="2.5" rx="0.5" fill="white"/>
                <rect x="9.5" y="17" width="2.5" height="2.5" rx="0.5" fill="white"/>
                <rect x="13" y="17" width="2.5" height="2.5" rx="0.5" fill="white"/>
                <rect x="16.5" y="17" width="2.5" height="2.5" rx="0.5" fill="white"/>
            </svg>
        </button>
        <button id="addTransactionBtn" class="floating-btn add-btn">➕</button>
    </div>

    <!-- 거래 등록 모달 -->
    <div id="transactionModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>➕ 새 거래 등록</h2>
                <button class="modal-close">&times;</button>
            </div>
            <form id="transactionForm">
                <div class="form-row">
                    <div class="form-group">
                        <label for="buyerName">구매자 이름 *</label>
                        <input type="text" id="buyerName" required>
                    </div>
                    <div class="form-group">
                        <label for="buyerPhone">연락처 *</label>
                        <input type="tel" id="buyerPhone" placeholder="010-1234-5678" required>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group" style="grid-column: 1 / -1;">
                        <label for="buyerAddress">배송지 주소</label>
                        <input type="text" id="buyerAddress" placeholder="배송지 주소 입력">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="brand">브랜드 *</label>
                        <div class="input-with-button">
                            <select id="brand" required>
                                <option value="">브랜드 선택</option>
                                <option value="custom">직접 입력</option>
                            </select>
                            <button type="button" class="btn-add" id="addBrandBtn" title="브랜드 추가">➕</button>
                            <button type="button" class="btn-remove" id="removeBrandBtn" title="브랜드 삭제">❌</button>
                        </div>
                        <input type="text" id="brandCustom" placeholder="브랜드명 직접 입력" style="display: none; margin-top: 8px;">
                    </div>
                    <div class="form-group">
                        <label for="productName">품명 *</label>
                        <input type="text" id="productName" required>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="quantity">수량 *</label>
                        <input type="number" id="quantity" min="1" value="1" required>
                    </div>
                    <div class="form-group">
                        <label for="purchaseDate">구매일자 *</label>
                        <input type="date" id="purchaseDate" required>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="purchaseSite">구매사이트 *</label>
                        <div class="input-with-button">
                            <select id="purchaseSite" required>
                                <option value="">사이트 선택</option>
                                <option value="other">기타</option>
                            </select>
                            <button type="button" class="btn-add" id="addSiteBtn" title="구매사이트 추가">➕</button>
                            <button type="button" class="btn-remove" id="removeSiteBtn" title="구매사이트 삭제">❌</button>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="purchaseSiteCustom">사이트명 (기타 선택시)</label>
                        <input type="text" id="purchaseSiteCustom" placeholder="직접 입력" disabled>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group" style="grid-column: 1 / -1;">
                        <label for="purchaseUrl">구매 상품 URL</label>
                        <input type="url" id="purchaseUrl" placeholder="https://example.com/product">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="purchasePrice">구매가격 (상품가격) *</label>
                        <input type="number" id="purchasePrice" step="0.01" min="0" required placeholder="예: 100.00">
                    </div>
                    <div class="form-group">
                        <label for="currency">통화 *</label>
                        <select id="currency" required>
                            <option value="KRW">KRW (원화)</option>
                            <option value="USD" selected>USD (달러)</option>
                            <option value="EUR">EUR (유로)</option>
                            <option value="GBP">GBP (파운드)</option>
                            <option value="JPY">JPY (엔화)</option>
                            <option value="CNY">CNY (위안)</option>
                        </select>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="exchangeRate">구매가격 환율 *</label>
                        <div class="input-with-button">
                            <input type="number" id="exchangeRate" step="0.01" min="0" placeholder="예: 1330.50" required>
                            <button type="button" class="btn-refresh" id="updateExchangeRateBtn" title="최신 환율 가져오기">🔄</button>
                        </div>
                        <small class="hint" id="exchangeRateHint">1 외화당 원화 환율 | <span id="exchangeRateUpdate">-</span></small>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="shippingMethod">해외배송 방식 *</label>
                        <select id="shippingMethod" required>
                            <option value="direct">직배송</option>
                            <option value="forwarding">배대지</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="internationalShipping">해외배송비</label>
                        <input type="number" id="internationalShipping" step="0.01" min="0" value="0" placeholder="예: 15.00">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="shippingCurrency">배송비 통화</label>
                        <select id="shippingCurrency">
                            <option value="KRW" selected>KRW (원화)</option>
                            <option value="USD">USD (달러)</option>
                            <option value="EUR">EUR (유로)</option>
                            <option value="GBP">GBP (파운드)</option>
                            <option value="JPY">JPY (엔화)</option>
                            <option value="CNY">CNY (위안)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="shippingExchangeRate">배송비 환율</label>
                        <div class="input-with-button">
                            <input type="number" id="shippingExchangeRate" step="0.01" min="0" value="1.0" placeholder="예: 1330.50">
                            <button type="button" class="btn-refresh" id="updateShippingExchangeRateBtn" title="최신 환율 가져오기">🔄</button>
                        </div>
                        <small class="hint" id="shippingExchangeRateHint">원화는 환율 1.0 고정 | <span id="shippingExchangeRateUpdate">-</span></small>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="salePrice">판매가격 (원) *</label>
                        <input type="number" id="salePrice" min="0" required>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="platform">판매 플랫폼 *</label>
                        <select id="platform" required>
                            <option value="coupang">쿠팡</option>
                            <option value="naver">네이버 쇼핑</option>
                            <option value="street11">11번가</option>
                            <option value="gmarket">G마켓</option>
                            <option value="auction">옥션</option>
                            <option value="direct">직거래</option>
                            <option value="custom">직접 입력</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="platformFee">판매 수수료율 (%)</label>
                        <input type="number" id="platformFee" step="0.1" min="0" value="10.0">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="customsDuty">관부과세 (원)</label>
                        <input type="number" id="customsDuty" min="0" value="0">
                    </div>
                    <div class="form-group">
                        <label for="shippingFee">국내배송비 (원)</label>
                        <input type="number" id="shippingFee" min="0" value="5000">
                    </div>
                </div>

                <div class="calculation-result">
                    <div class="calc-item">
                        <span>총 비용:</span>
                        <strong id="calcTotalCost">0원</strong>
                    </div>
                    <div class="calc-item">
                        <span>순이익:</span>
                        <strong id="calcProfit" class="profit">0원</strong>
                    </div>
                    <div class="calc-item">
                        <span>마진률:</span>
                        <strong id="calcMargin">0%</strong>
                    </div>
                </div>

                <button type="submit" class="btn-submit">등록하기</button>
            </form>
        </div>
    </div>

    <!-- 마진율 계산기 모달 -->
    <div id="marginCalculatorModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>🖩 마진율 계산기</h2>
                <button class="modal-close calc-close">&times;</button>
            </div>
            <div class="calculator-form">
                <div class="form-row">
                    <div class="form-group">
                        <label for="calcPurchasePrice">구매가격 (상품가격) *</label>
                        <input type="number" id="calcPurchasePrice" step="0.01" min="0" placeholder="예: 100.00">
                    </div>
                    <div class="form-group">
                        <label for="calcCurrency">통화 *</label>
                        <select id="calcCurrency">
                            <option value="KRW">KRW (원화)</option>
                            <option value="USD" selected>USD (달러)</option>
                            <option value="EUR">EUR (유로)</option>
                            <option value="GBP">GBP (파운드)</option>
                            <option value="JPY">JPY (엔화)</option>
                            <option value="CNY">CNY (위안)</option>
                        </select>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="calcInternationalShipping">해외배송비</label>
                        <input type="number" id="calcInternationalShipping" step="0.01" min="0" value="0" placeholder="예: 15.00">
                    </div>
                    <div class="form-group">
                        <label for="calcShippingCurrency">배송비 통화</label>
                        <select id="calcShippingCurrency">
                            <option value="KRW" selected>KRW (원화)</option>
                            <option value="USD">USD (달러)</option>
                            <option value="EUR">EUR (유로)</option>
                            <option value="GBP">GBP (파운드)</option>
                            <option value="JPY">JPY (엔화)</option>
                            <option value="CNY">CNY (위안)</option>
                        </select>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="calcExchangeRate">구매가격 환율 *</label>
                        <div class="input-with-button">
                            <input type="number" id="calcExchangeRate" step="0.01" min="0" placeholder="예: 1330.50">
                            <button type="button" class="btn-refresh" id="calcUpdateExchangeRateBtn" title="최신 환율 가져오기">🔄</button>
                        </div>
                        <small class="hint" id="calcExchangeRateHint">1 외화당 원화 환율 | <span id="calcExchangeRateUpdate">-</span></small>
                    </div>
                    <div class="form-group">
                        <label for="calcShippingExchangeRate">배송비 환율</label>
                        <div class="input-with-button">
                            <input type="number" id="calcShippingExchangeRate" step="0.01" min="0" value="1.0" placeholder="예: 1330.50">
                            <button type="button" class="btn-refresh" id="calcUpdateShippingExchangeRateBtn" title="최신 환율 가져오기">🔄</button>
                        </div>
                        <small class="hint" id="calcShippingExchangeRateHint">원화는 환율 1.0 고정 | <span id="calcShippingExchangeRateUpdate">-</span></small>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="calcSalePrice">판매가격 (원) *</label>
                        <input type="number" id="calcSalePrice" min="0" placeholder="예: 250000">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="calcPlatform">판매 플랫폼 *</label>
                        <select id="calcPlatform">
                            <option value="coupang">쿠팡 (10.0%)</option>
                            <option value="naver">네이버 (5.6%)</option>
                            <option value="street11">11번가 (11.0%)</option>
                            <option value="gmarket">G마켓 (12.0%)</option>
                            <option value="auction">옥션 (12.0%)</option>
                            <option value="direct">직거래 (0%)</option>
                            <option value="custom">기타</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="calcPlatformFee">플랫폼 수수료 (%)</label>
                        <input type="number" id="calcPlatformFee" step="0.1" min="0" max="100" value="10.0" placeholder="예: 10.0">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="calcCustomsDuty">관부과세 (원)</label>
                        <input type="number" id="calcCustomsDuty" min="0" value="0" placeholder="예: 15000">
                    </div>
                    <div class="form-group">
                        <label for="calcShippingFee">국내배송비 (원)</label>
                        <input type="number" id="calcShippingFee" min="0" value="5000" placeholder="예: 5000">
                    </div>
                </div>

                <div class="calculation-result">
                    <h3>💰 계산 결과</h3>
                    <div class="result-item">
                        <span class="result-label">총 비용:</span>
                        <strong id="calcResultTotalCost">0원</strong>
                    </div>
                    <div class="result-item">
                        <span class="result-label">순이익:</span>
                        <strong id="calcResultProfit" class="profit">0원</strong>
                    </div>
                    <div class="result-item">
                        <span class="result-label">마진율:</span>
                        <strong id="calcResultMargin">0%</strong>
                    </div>
                </div>

                <button type="button" class="btn-reset" id="resetCalculatorBtn">🔄 초기화</button>
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"></script>
    <script src="script.js"></script>
</body>
</html>
